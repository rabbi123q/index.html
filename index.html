<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>rabbi</title>
  <style>
    body { font-family: Arial; background: #f2f2f2; text-align: center; padding: 30px; }
    .container { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input { width: 80%; padding: 10px; margin: 10px 0; font-size: 16px; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; border: none; background: #28a745; color: #fff; border-radius: 5px; }
    button:hover { background: #218838; }
    .email-list { text-align: left; margin-top: 20px; }
    .email-item { padding: 10px; border-bottom: 1px solid #ccc; }
  </style>
</head>
<body>
  <div class="container">
    <h2>rabbi</h2>
    <input type="text" id="emailField" readonly>
    <button onclick="copyEmail()">Copy</button>
    <div class="email-list" id="emailList">Loading...</div>
  </div>  <script>
    let token = '';
    let userId = '';
    let address = '';

    async function generateEmail() {
      const res = await fetch('https://api.mail.tm/accounts', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          address: `rabbi${Math.random().toString(36).substring(2, 10)}@tmpmail.lol`,
          password: 'Password123@'
        })
      });
      const json = await res.json();
      address = json.address;
      document.getElementById('emailField').value = address;
      login(address);
    }

    async function login(email) {
      const res = await fetch('https://api.mail.tm/token', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          address: email,
          password: 'Password123@'
        })
      });
      const json = await res.json();
      token = json.token;
      getMe();
      getEmails();
    }

    async function getMe() {
      const res = await fetch('https://api.mail.tm/me', {
        headers: { Authorization: `Bearer ${token}` }
      });
      const json = await res.json();
      userId = json.id;
    }

    async function getEmails() {
      const res = await fetch('https://api.mail.tm/messages', {
        headers: { Authorization: `Bearer ${token}` }
      });
      const emails = await res.json();
      const emailList = document.getElementById('emailList');
      emailList.innerHTML = '';
      if (emails['hydra:member'].length === 0) {
        emailList.innerHTML = '<p>No emails yet.</p>';
      } else {
        for (const mail of emails['hydra:member']) {
          emailList.innerHTML += `<div class="email-item"><strong>From:</strong> ${mail.from.address}<br><strong>Subject:</strong> ${mail.subject}</div>`;
        }
      }
    }

    function copyEmail() {
      const email = document.getElementById('emailField');
      email.select();
      document.execCommand('copy');
      alert('Email copied!');
    }

    setInterval(() => {
      if (token !== '') getEmails();
    }, 5000);

    // Init
    generateEmail();
  </script></body>
</html>
