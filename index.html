<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Temp Mail Inbox</title>
  <style>
    body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
    .container { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; }
    h2 { text-align: center; }
    .email { padding: 10px; margin: 10px 0; background: #eaeaea; border-radius: 6px; }
    .email p { margin: 5px 0; }
    .email strong { color: #333; }
    #email-address { text-align: center; font-weight: bold; font-size: 1.2em; margin-bottom: 15px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Temp Mail Inbox (Mail.tm)</h2>
    <div id="email-address">Loading email...</div>
    <div id="inbox">Fetching inbox...</div>
  </div>

  <script>
    const api = 'https://api.mail.tm';
    let token = '';
    let email = 'user' + Math.floor(Math.random() * 100000) + '@mail.tm';
    let password = 'test123456';

    async function createAccount() {
      await fetch(api + '/accounts', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({address: email, password})
      }).catch(() => {});
    }

    async function getToken() {
      const res = await fetch(api + '/token', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({address: email, password})
      });
      const data = await res.json();
      token = data.token;
    }

    async function getInbox() {
      const res = await fetch(api + '/messages', {
        headers: { Authorization: 'Bearer ' + token }
      });
      const data = await res.json();
      const inboxDiv = document.getElementById('inbox');
      inboxDiv.innerHTML = '';
      if (data['hydra:member'].length === 0) {
        inboxDiv.innerHTML = '<p>No messages yet. Wait for Facebook code...</p>';
      } else {
        data['hydra:member'].forEach(msg => {
          inboxDiv.innerHTML += `
            <div class="email">
              <p><strong>Subject:</strong> ${msg.subject}</p>
              <p><strong>From:</strong> ${msg.from.address}</p>
              <p><strong>Time:</strong> ${msg.intro}</p>
            </div>
          `;
        });
      }
    }

    async function start() {
      await createAccount();
      await getToken();
      document.getElementById('email-address').innerText = `Email: ${email}`;
      setInterval(getInbox, 5000); // check inbox every 5 seconds
    }

    start();
  </script>
</body>
</html>
