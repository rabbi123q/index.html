<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Working TempMail Inbox</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; text-align: center; padding: 40px; }
    .box { background: #fff; padding: 20px; border-radius: 8px; max-width: 600px; margin: auto; box-shadow: 0 0 10px #ccc; }
    .email-item { border-bottom: 1px solid #ddd; padding: 10px; text-align: left; }
    input, button { padding: 10px; margin: 10px; font-size: 16px; }
  </style>
</head>
<body>
  <div class="box">
    <h2>Working TempMail Inbox</h2>
    <input type="text" id="emailBox" readonly>
    <button onclick="generateEmail()">Generate Email</button>
    <div id="inbox"><p>Inbox loading...</p></div>
  </div>

  <script>
    let token = "";
    let email = "";
    let id = "";

    async function generateEmail() {
      const response = await fetch('https://api.mail.tm/accounts', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          address: '',
          password: 'Temp1234!'
        })
      });

      const data = await response.json();
      email = data.address;
      document.getElementById("emailBox").value = email;

      const loginRes = await fetch('https://api.mail.tm/token', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          address: email,
          password: 'Temp1234!'
        })
      });
      const loginData = await loginRes.json();
      token = loginData.token;
      loadInbox();
    }

    async function loadInbox() {
      if (!token) return;
      const res = await fetch('https://api.mail.tm/messages', {
        headers: { Authorization: `Bearer ${token}` }
      });
      const messages = await res.json();
      const inbox = document.getElementById("inbox");
      inbox.innerHTML = '';

      if (messages['hydra:member'].length === 0) {
        inbox.innerHTML = '<p>No messages yet.</p>';
      } else {
        messages['hydra:member'].forEach(msg => {
          const item = document.createElement("div");
          item.className = "email-item";
          item.innerHTML = `<b>From:</b> ${msg.from.address}<br><b>Subject:</b> ${msg.subject}`;
          inbox.appendChild(item);
        });
      }
    }

    // Auto refresh every 5 seconds
    setInterval(loadInbox, 5000);
    window.onload = generateEmail;
  </script>
</body>
</html>
